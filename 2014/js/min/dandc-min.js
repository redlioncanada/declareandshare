function te(e,r,t){ga("send","event",e,r,t)}function forward_to_entry(e,r){window.location.replace(forward_url+e+"/"+r)}function validateEmail(e){var r=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return r.test(e)}function set_error(e){e.siblings("p").removeClass("invisible"),e.parent().parent().addClass("has-error")}function clear_error(e){e.siblings("p").addClass("invisible"),e.parent().parent().removeClass("has-error")}function facebook_share_pixel(){!function(){var e=window._fbq||(window._fbq=[]);if(!e.loaded){var r=document.createElement("script");r.async=!0,r.src="//connect.facebook.net/en_US/fbds.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(r,t),e.loaded=!0}}(),window._fbq=window._fbq||[],window._fbq.push(["track","6019730980066",{value:"0.01",currency:"CAD"}])}!function(e,r,t,o,n,a,i){e.GoogleAnalyticsObject=n,e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},e[n].l=1*new Date,a=r.createElement(t),i=r.getElementsByTagName(t)[0],a.async=1,a.src=o,i.parentNode.insertBefore(a,i)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-45487332-1","auto"),ga("require","displayfeatures"),ga("send","pageview"),window.fbAsyncInit=function(){FB.init({appId:"865812323452284",xfbml:!0,version:"v2.1"})},function(e,r,t){var o,n=e.getElementsByTagName(r)[0];e.getElementById(t)||(o=e.createElement(r),o.id=t,o.src="//connect.facebook.net/en_CA/sdk.js",n.parentNode.insertBefore(o,n))}(document,"script","facebook-jssdk"),function($){$.fn.snow=function(e){var r=$('<div class="flake" />').css({position:"absolute","z-index":"10",top:"-100px"}).html("&#10052;"),t=$("#home-header").height(),o=$("#home-header").width(),n={minSize:10,maxSize:20,newOn:500,flakeColor:"#FFFFFF"},e=$.extend({},n,e),a=setInterval(function(){var n=Math.random()*o-100,a=.5+Math.random(),i=e.minSize+Math.random()*e.maxSize,l=t-40,s=n-100+200*Math.random(),c=10*t+5e3*Math.random();r.clone().appendTo("body").css({left:n,opacity:a,"font-size":i,color:e.flakeColor}).animate({top:l,left:s,opacity:.2},c,"linear",function(){$(this).remove()})},e.newOn)}}(jQuery),$(function(){var e=window.screen.height<=600;$("#home-header").length&&!e&&$.fn.snow({minSize:30,maxSize:100,flakeColor:"#eaf9fb"}),e&&($("#home-header").height("460px"),$("#snowy-hill p").css("font-size","13px")),$(".color-btn").tooltip(),$(".color-btn").on("click",function(){if(te(product_slug,"color-change",$(this).attr("data-color")),color_slug!==$(this).attr("data-color")){var e=$(this);color_slug=$(this).attr("data-color"),color_image_slug=$(this).attr("data-image"),color_name=$(this).attr("data-colorname"),$("#product-img").fadeOut(300,function(){$("#product-img").attr("src",e.attr("data-newimage")),$("#product-img").load(function(){$("#product-img").fadeIn(300)})})}}),$("#share-facebook").on("click",function(){te(product_slug,"facebook",""),facebook_share_pixel();var e=base_url+product_slug+"/"+color_slug+lang;console.log(e),FB.ui({method:"share",href:e},function(e){console.log(e),forward_to_entry(product_slug,color_slug)})}),$("#share-twitter").on("click",function(){te(product_slug,"twitter",""),facebook_share_pixel();var e=base_url+product_slug+"/"+color_slug+lang,r="https://twitter.com/intent/tweet?text="+encodeURIComponent(tw_share)+"&url="+encodeURIComponent(e);window.open(r),forward_to_entry(product_slug,color_slug)}),$("#share-pinterest").on("click",function(){te(product_slug,"pinterest",""),facebook_share_pixel();var e=base_url+product_slug+"/"+color_slug+lang,r=media_base_url+product_slug+"/share/"+color_image_slug+".jpg",t=pin_share.replace("[[COLOR]]",color_name),o="http://pinterest.com/pin/create/button/?url="+encodeURIComponent(e)+"&media="+encodeURIComponent(r)+"&description="+encodeURIComponent(t);window.open(o),forward_to_entry(product_slug,color_slug)}),$("#share-mail").on("click",function(){facebook_share_pixel(),te(product_slug,"email","")}),$("select#input_product_id").on("change",function(){if($(this).val()>0){var e="#"+$("option:selected",this).attr("data-slug");$("#input_color_id").html($(e).html()),$("#input_color_id").removeAttr("disabled")}else $("#input_color_id").html(""),$("#input_color_id").prop("disabled","disabled")}),$("#send_btn").on("click",function(e){te(product_slug,"email","send"),$("#email_alert").addClass("hidden");var r=!0;""!==$("#input_youremail").val()&&validateEmail($("#input_youremail").val())?$("#input_youremail").parent().removeClass("has-error"):(r=!1,$("#input_youremail").parent().addClass("has-error")),""!==$("#input_friendemail").val()&&validateEmail($("#input_friendemail").val())?$("#input_friendemail").parent().removeClass("has-error"):(r=!1,$("#input_friendemail").parent().addClass("has-error")),""===$("#input_yourname").val()?(r=!1,$("#input_yourname").parent().addClass("has-error")):$("#input_yourname").parent().removeClass("has-error"),""===$("#input_friendname").val()?(r=!1,$("#input_friendname").parent().addClass("has-error")):$("#input_friendname").parent().removeClass("has-error"),r&&$.ajax({type:"POST",url:"/share/mailshare/"+product_slug+"/"+color_slug,data:$("#send_mail").serialize(),success:function(e){"none"==e.error||null==e.response.reject_reason?(te(product_slug,"email","success"),forward_to_entry(product_slug,color_slug)):(te(product_slug,"email","error"),$("#email_alert").removeClass("hidden"))},dataType:"JSON"})}),$("#enter_now").on("click",function(e){e.preventDefault(),te("entry-form","submit","");var r=!0;return""==$("#input_firstname").val()?(set_error($("#input_firstname")),r=!1):clear_error($("#input_firstname")),""==$("#input_lastname").val()?(set_error($("#input_lastname")),r=!1):clear_error($("#input_lastname")),""!=$("#input_email").val()&&validateEmail($("#input_email").val())?clear_error($("#input_email")):(set_error($("#input_email")),r=!1),$("#input_email").val()!=$("#input_email_confirm").val()?(set_error($("#input_email_confirm")),r=!1):clear_error($("#input_email_confirm")),$("#input_terms").is(":checked")?clear_error($("#input_terms")):(set_error($("#input_terms")),r=!1),0==$("#input_product_id").val()?(set_error($("#input_product_id")),r=!1):clear_error($("#input_product_id")),0==$("#input_color_id").val()?(set_error($("#input_color_id")),r=!1):clear_error($("#input_color_id")),r?void $("#entryform").submit():(te("entry-form","submit","error"),!1)}),$("body :not(script)").contents().filter(function(){return 3===this.nodeType}).replaceWith(function(){return this.nodeValue.replace(/[™®©]/g,"<sup>$&</sup>")}),$(".home-click").on("click",function(){te("home",$(this).prop("data-product"),"")})});